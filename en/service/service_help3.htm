<html>
<head>
<title>高性能计算服务</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="../css/ncic.css" type="text/css">
<script language="JavaScript">
<!--
function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}

function MM_findObj(n, d) { //v4.0
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && document.getElementById) x=document.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}
//-->
</script>
</head>

<body bgcolor="#FFFFFF" text="#000000" leftmargin="0" topmargin="0" onLoad="MM_preloadImages('../images/arrow_02.gif')">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td width="547"><img src="../image/top.jpg" width="547" height="123"></td>
    <td background="../image/top_1.jpg" align="right"><img src="../image/top_2.jpg" width="131" height="123"></td>
  </tr>
</table>
<table width="720" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td width="163" align="center" valign="top"> 
      <table width="163" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td><a href="../about/about.htm"><img src="../image/niu1.jpg" width="163" height="26" border="0"></a></td>
        </tr>
      </table>
      <table width="163" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td><a href="../product/product.htm"><img src="../image/niu2.jpg" width="163" height="23" border="0"></a></td>
        </tr>
      </table>
      <table width="163" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td><a href="../road/road.htm"><img src="../image/niu3.jpg" width="163" height="23" border="0"></a></td>
        </tr>
        <tr> 
          <td><a href="../paper/paper.htm"><img src="../image/niu4.jpg" width="163" height="23" border="0"></a></td>
        </tr>
        <tr> 
          <td><a href="../now/now.htm"><img src="../image/niu5.jpg" width="163" height="24" border="0"></a></td>
        </tr>
        <tr> 
          <td><a href="../news/news.htm"><img src="../image/niu6.jpg" width="163" height="26" border="0"></a></td>
        </tr>
        <tr> 
          <td><a href="../link/link.htm"><img src="../image/niu7.jpg" width="163" height="23" border="0"></a></td>
        </tr>
        <tr> 
          <td><a href="service.htm"><img src="../image/niu8.jpg" width="163" height="24" border="0"></a></td>
        </tr>
      </table>
      <br>
      <a href="../index_e.htm"><img src="../image2/back.gif" width="80" height="17" align="right" border="0"></a><br>
      <br>
      <br>
      <br>
    </td>
    <td width="30">&nbsp;</td>
    <td valign="top" align="right"> 
      <table width="480" border="0" cellspacing="0" cellpadding="0" >
        <tr> 
          <td align="right" valign="bottom"><img src="../image2/top2.gif" width="476" height="97"></td>
        </tr>
        <tr> 
          <td align="right" height="5"><img src="../image/line.gif" width="481" height="3"></td>
        </tr>
      </table>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td height="10"><img src="../images/spacer.gif" width="1" height="1"></td>
        </tr>
      </table>
      <table width="480" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td width="11"><img src="../images/service_bar_start.gif" width="11" height="22"></td>
          <td class="padding01" align="center" background="../images/service_bar_bg.gif"> 
            在线帮助 </td>
          <td width="7" align="right" background="../images/service_bar_bg.gif"><img src="../images/service_bar_splite.gif" width="7" height="22"></td>
          <td background="../images/service_bar_bg01.gif" align="right"> 
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
              <tr> 
                <td align="center" width="20"><img src="../images/arrow_03.gif" width="8" height="20" border="0" name="ansys"></td>
                <td class="padding01" width="50"><a href="service_help.htm" class="link05" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('ansys','','../images/arrow_02.gif',1)">上机入门</a></td>
                <td width="20" align="center"><img src="../images/arrow_03.gif" width="8" height="20" border="0" name="star"></td>
                <td class="padding01" width="50"><a href="service_help1.htm" class="link05" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('star','','../images/arrow_02.gif',1)">编译环境</a></td>
                <td align="center" width="20"><img src="../images/arrow_03.gif" width="8" height="20" border="0" name="dyna"></td>
                <td class="padding01" width="60"><a href="service_help2.htm" class="link05" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('dyna','','../images/arrow_02.gif',1)">PVM的使用</a> 
                </td>
                <td width="20" align="center"><img src="../images/arrow_03.gif" width="8" height="20" border="0" name="gauss"></td>
                <td class="padding01" width="60"><a href="service_help3.htm" class="link05" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('gauss','','../images/arrow_02.gif',1)">MPI的使用</a></td>
                <td align="center" width="20"><img src="../images/arrow_03.gif" width="8" height="20" name="link"></td>
                <td class="padding01" width="60"><a href="service_help4.htm" class="link05" onMouseOut="MM_swapImgRestore()" onMouseOver="MM_swapImage('link','','../images/arrow_02.gif',1)">ESSL的使用</a></td>
                <td class="padding01" align="center">&nbsp;</td>
              </tr>
            </table>
          </td>
          <td width="10"><img src="../images/service_bar_end.gif" width="10" height="22"></td>
        </tr>
      </table>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td height="5"><img src="../images/spacer.gif" width="1" height="1"></td>
        </tr>
      </table>
      <table width="480" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td width="11"><img src="../images/service_cor01.gif" width="11" height="6"></td>
          <td background="../images/service_tbg.gif"><img src="../images/service_tbg.gif" width="7" height="6"></td>
          <td width="10"><img src="../images/service_cor02.gif" width="10" height="6"></td>
        </tr>
      </table>
      <table width="480" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td bgcolor="#74558D" width="1"><img src="../images/spacer.gif" width="1" height="1"></td>
          <td> 
            <table width="100%" border="0" cellspacing="0" cellpadding="8">
              <tr> 
                <td> 
                  <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr> 
                      <td align="center"><b><font size="4">MPI简介 </font></b></td>
                    </tr>
                  </table>
                  <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr> 
                      <td background="../images/dotline_02.gif"><img src="../images/dotline_02.gif" width="4" height="10"></td>
                    </tr>
                  </table>
                  　　MPI（Message Passing Interface）是消息传递并行程序设计的标准之一，当前通用的是MPI1.1规范。正在制定的MPI2.0规范除支持消息传递外，还支持MPI的I/O规范和进程管理规范。MPI正成为并行程序设计事实上的工业标准。 
                  <p>　　MPI的实现包括MPICH、LAM、IBM MPL等多个版本，最常用和稳定的是MPICH，曙光天潮系列的MPI以MPICH为基础进行了定制和优化。</p>
                  <p>　　MPICH含三层结构，最上层是MPI的API，基本是点到点通信，和在点到点通信基础上构造的集群通信（Collective 
                    Communication）；中间层是ADI层（Abstract Device Interface），其中device可以简单地理解为某一种底层通信库，ADI就是对各种不同的底层通信库的不同接口的统一标准；底层是具体的底层通信库，例如工作站机群上的p4通信库、曙光1000上的NX库、曙光3000上的BCL通信库等。</p>
                  <p>　　MPICH的1.0.12版本以下都采用第一代ADI接口的实现方法，利用底层device提供的通信原语和有关服务函数实现所有的ADI接口，可以直接实现，也可以依靠一定的模板间接实现。自1.0.13版本开始，MPICH采用第二代ADI接口。</p>
                  <p>　　我们将MPICH移植到曙光3000高效通信库BCL(Basic Communication Library)上(简称MPI_BCL)。MPI_BCL的接口标准与MPICH版本1.1完全一致，满足MPI1.1标准。同时，也支持ch_p4的通信库，即利用TCP/IP通信机制。从网络硬件角度说，MPI_BCL针对系统网络，MPI_ch_p4针对高速以太网。</p>
                  <p><b>1.MPI的程序设计</b></p>
                  <p>　　MPI1.1标准基于静态加载，即所有进程在加载完以后就全部确定，直至整个程序结束才终止，在程序运行期间没有进程的创建和结束。一个MPI程序的所有进程形成一个缺省的组，这个组被MPI预先规定的Communicator 
                    MPI_COMM_WORLD所确定。</p>
                  <p>　　MPI环境的初始化和结束流程如下：在调用MPI例程之前，各个进程都应该执行MPI_INIT，接着调用MPI_COMM_SIZE获取缺省组(group)的大小，调用MPI_COMM_RANK获取调用进程在缺省组中的逻辑编号（从0开始）。然后，进程可以根据需要，向其它节点发送消息或接收其它节点的消息，经常调用的函数是MPI_SEND和MPI_RECV。最后，当不需要调用任何MPI例程后，调用MPI_FINALIZE消除MPI环境，进程此时可以结束，也可以继续执行与MPI无关的语句。</p>
                  <p>　　上面提到的六个函数：MPI_INIT，MPI_COMM_SIZE，MPI_COMM_RANK，MPI_SEND，MPI_RECV，MPI_FINALIZE 
                    实际上构成了编写一个完整的MPI程序所需例程的最小集。</p>
                  <p><b>2.MPI的几个重要特征</b></p>
                  <p>　　下面分别介绍MPI的几个重要特征：Communicator（通信空间）、Group（进程组）、Context_id（上下文标识）、Data 
                    Types（数据类型）。<br>
                    MPI提供Communicator来指定通信操作的上下文，提供了通信操作的执行空间。在某个通信空间（或上下文）中发送的消息必须在相同的空间中接收，不同空间中的消息互不干扰。定义一个Communicator，也就指定了一组共享该空间的进程，这些进程组成了该Communicator的Group。</p>
                  <p>　　Communicator通过其特征属性Context_id来区分，同一个进程不同的Communicator有不同的Context_id。因此Context_id是另一个区分消息的标志。</p>
                  <p>　　MPI引入消息的Data Type属性的目的有两个：一是支持异构系统计算；二是允许消息来自不连续的或类型不一致的存储区，例如，可以传送数组的一列，或传送一个结构值，而该结构的每个元素的类型不同。Data 
                    Types定义了消息中不连续的数据项及其可能不同的数据类型。Data Type由应用程序在执行时通过基本的数据类型创建。</p>
                  <p><b>3.消息</b></p>
                  <p>　　一个消息相当于一封信，消息内容相当于信本身，消息的接收者相当于信封上的内容。因此通常将前者称为消息的buffer, 
                    后者称为消息的envelop。</p>
                  <p></p>
                  <p>　　buffer: message address, count, datatype;<br>
                    　　envelop: process id, message tag,communicator</p>
                  <p>　　在MPI以前的大多数通信系统中，消息buffer通常仅由buffer的地址和长度决定（例如曙光1000上的NX通信系统），那么在MPI的消息格式中为什么要引入Data 
                    Type呢？这有两个主要原因：</p>
                  <p>　　支持异构计算：不同系统有不同的数据表示。解决这一问题的方法是预先定义一些基本数据类型，MPI实现过程中对这些类型进行转换，例如转换为XDR格式，接收时进行反转。</p>
                  <p>　　派生的数据类型（Derived Data Types）：允许消息来自于不连续的和类型不一致的存储区域。 </p>
                  <p><b>4.MPI应用程序的编译</b></p>
                  <p><b>Include文件</b></p>
                  <p>　　C语言应用程序应有<br>
                    　　　　#include &quot;mpi.h&quot;<br>
                    　　若使用cc编译，命令行应有：<br>
                    　　　　-I/cluster/mpi/net/include (net版)<br>
                    　　　　-I/cluster/bcl/include -I/cluster/rms/include -I/cluster/sdr/include 
                    -I/cluster/mpi/mesh/include (mesh版)</p>
                  <p>　　Fortran语言应用程序应有<br>
                    　　　include 'mpif.h'<br>
                    　　若使用f77编译, 命令行应有：<br>
                    　　　　-I/cluster/mpi/net/include (net版)<br>
                    　　　　-I/cluster/bcl/include -I/cluster/rms/include -I/cluster/sdr/include 
                    -I/cluster/mpi/mesh/include (mesh版)</p>
                  <p><b>MPI库文件</b></p>
                  <p>C语言<br>
                    　　C语言程序编译时需作下述链接：<br>
                    　　　　-L/cluster/mpi/net/lib -lmpi -lbsd (net版)<br>
                    　　　　-L/cluster/mpi/mesh/lib -L/cluster/bcl/lib -L/cluster/rms/lib 
                    -L/cluster/sdr/lib -lmpi -lbcl -lrms -lsdr (mesh版)<br>
                    　　数学函数库还应链接： -lm</p>
                  <p>Fortran语言<br>
                    　　Fortran编译时应作下述链接：<br>
                    　　　　-L/cluster/mpi/net/lib -lmpi -lbsd (net版)<br>
                    　　　　-L/cluster/mpi/mesh/lib -L/cluster/bcl/lib -L/cluster/rms/lib 
                    -L/cluster/sdr/lib -lmpi -lbcl -lrms -lsdr (mesh版)</p>
                  <p><b>mpif77和mpicc</b></p>
                  <p>　　MPI提供了两个工具(mpif77和mpicc)来简化MPI应用程序的编译。用户可以直接地使用命令行方式mpicc或mpif77来编译C或Fortran程序，编译方式与cc和f77完全一致。如：<br>
                    　　　　mpif77 -c foo.f<br>
                    　　　　mpicc -c foo.c<br>
                    　　　　mpif77 -o foo foo.o<br>
                    　　　　mpicc -o foo foo.o<br>
                    　　有时链接时需一些特殊库, 应在链接时注明。使用mpicc和mpif77省略了有关MPI的路径设置。</p>
                  <p><b>5.MPI应用程序的运行</b></p>
                  <p>　　应用程序编译好后，使用mpirun命令运行MPI应用程序。mpirun命令完整的格式如下：<br>
                    　　　　mpirun [-h|-?|-help] [-sz size|-sz hXw] [-np nprocs] [-pl 
                    poolname] &lt;progname [argument]&gt;<br>
                    　　各个选项的值由用户从命令行中显示地指定，选项的含义如下： <br>
                    　　-h<br>
                    　　-?<br>
                    　　-help：显示帮助信息。</p>
                  <p>　　-sz &lt;size| hXw&gt;<br>
                    　　指定物理节点的数目。有两种指定形式，一是直接指定size值，另一种是指定物理节点的矩形域的长和宽。size值和h*w的值如果超过所在pool的节点数，sz项的值取pool的节点数，h*w值取整个pool。两者的缺省值分别为所在pool的节点数和整个pool。</p>
                  <p>　　-np &lt;nprocs&gt;<br>
                    　　用户期望运行的进程数。进程数与实际申请的物理节点数没有任何联系，因为允许一个节点上运行同一个应用的多个进程。如果未指定，取实际sz项的值。</p>
                  <p>　　-pl poolname<br>
                    　　应用程序执行的pool。应用程序的每次执行能且只能在一个pool中执行。缺省值为系统为用户设置的缺省的pool名（每个用户在创建时已自行指定或系统分配了一个缺省的pool）。 
                  </p>
                  <p>　　在运行选项后，是用户的程序名。该可执行文件必须在所指定的或缺省的pool中的所有节点上能找到，并且与启动节点上的路径一致。用户程序名后的一切字符串都视为其参数（不包括被shell解释的重定向等，对shell解释的一些特殊字符，如需作为参数，应作相应的转换）。因此运行选项与用户程序名有先后的顺序，先运行选项，后用户程序名和参数。</p>
                </td>
              </tr>
            </table>
          </td>
          <td bgcolor="#74558D" width="1"><img src="../images/spacer.gif" width="1" height="1"></td>
        </tr>
      </table>
      <table width="480" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td width="11"><img src="../images/service_cor03.gif" width="11" height="6"></td>
          <td background="../images/service_bbg.gif"><img src="../images/service_bbg.gif" width="7" height="6"></td>
          <td width="10"><img src="../images/service_cor04.gif" width="10" height="6"></td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <td width="163" align="center" valign="top">&nbsp;</td>
    <td width="30">&nbsp;</td>
    <td valign="top" align="right"> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td height="5"><img src="../images/spacer.gif" width="1" height="1"></td>
        </tr>
      </table>
      <table width="480" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td width="11"><img src="../images/service_bar_start.gif" width="11" height="22"></td>
          <td background="../images/service_bar_bg01.gif" width="100" class="padding01">&nbsp;</td>
          <td width="7" background="../images/service_bar_bg01.gif">&nbsp;</td>
          <td background="../images/service_bar_bg01.gif" align="right"> 
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
              <tr> 
                <td align="center">&nbsp;</td>
                <td width="20" align="center">&nbsp;</td>
                <td class="padding01" width="70">&nbsp;</td>
                <td width="20" align="center">&nbsp;</td>
                <td class="padding01" width="70">&nbsp;</td>
                <td width="20" align="center"><img src="../images/service_bar_next.gif" width="13" height="22"></td>
                <td class="padding01" width="70"><a href="service_help3_1.htm" class="link05">下一页</a></td>
              </tr>
            </table>
          </td>
          <td width="10"><img src="../images/service_bar_end.gif" width="10" height="22"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<br>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td bgcolor="#999999" height="1"><img src="../image/dot00.gif" width="1" height="1"></td>
  </tr>
  <tr> 
    <td align="center"> 
      <font face="Verdana, Arial, Helvetica, sans-serif" size="1">Copyright 
        for NCIC All Rights Reserved</font> <br>
        本网站版权归国家智能计算机研究开发中心所有<br>
      
    </td>
  </tr>
</table>
</body>
</html>
